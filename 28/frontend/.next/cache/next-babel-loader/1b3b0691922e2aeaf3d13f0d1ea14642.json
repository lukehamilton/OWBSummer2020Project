{"ast":null,"code":"import _styled from \"@emotion/styled-base\";\nvar _jsxFileName = \"/Users/lukehamilton/development/lyra-labs-dev/lyra-labs/frontend/components/wallet-settings/index.js\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect } from \"react\";\nimport * as sdk from \"@onflow/sdk\";\nimport JSONPretty from \"react-json-pretty\";\nimport CoralButton from \"@library/components/buttons/coral\";\nimport MintButton from \"@library/components/buttons/mint\";\nimport GradientButton from \"@library/components/buttons/gradient\";\nimport checkReference from \"../../flow/scripts/check-ref.cdc\";\nimport userVault from \"../../flow/transactions/user-vault.cdc\";\nimport * as fcl from \"@onflow/fcl\";\nimport { WHITE, LIGHT_CORAL, MAGIC_MINT } from \"@style/colors\";\n\nconst Container = /*#__PURE__*/_styled(\"div\", {\n  target: \"e1fz02ct0\",\n  label: \"Container\"\n})({\n  display: \"flex\",\n  flexDirection: \"column\",\n  borderRadius: 3,\n  backgroundColor: WHITE,\n  boxShadow: \"0 1px 2px 0 rgba(0,0,0,.1)\",\n  padding: \"1rem\"\n}, false ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9sdWtlaGFtaWx0b24vZGV2ZWxvcG1lbnQvbHlyYS1sYWJzLWRldi9seXJhLWxhYnMvZnJvbnRlbmQvY29tcG9uZW50cy93YWxsZXQtc2V0dGluZ3MvaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBWWtCIiwiZmlsZSI6Ii9Vc2Vycy9sdWtlaGFtaWx0b24vZGV2ZWxvcG1lbnQvbHlyYS1sYWJzLWRldi9seXJhLWxhYnMvZnJvbnRlbmQvY29tcG9uZW50cy93YWxsZXQtc2V0dGluZ3MvaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlU3RhdGUsIHVzZUVmZmVjdCB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0ICogYXMgc2RrIGZyb20gXCJAb25mbG93L3Nka1wiO1xuaW1wb3J0IEpTT05QcmV0dHkgZnJvbSBcInJlYWN0LWpzb24tcHJldHR5XCI7XG5pbXBvcnQgQ29yYWxCdXR0b24gZnJvbSBcIkBsaWJyYXJ5L2NvbXBvbmVudHMvYnV0dG9ucy9jb3JhbFwiO1xuaW1wb3J0IE1pbnRCdXR0b24gZnJvbSBcIkBsaWJyYXJ5L2NvbXBvbmVudHMvYnV0dG9ucy9taW50XCI7XG5pbXBvcnQgR3JhZGllbnRCdXR0b24gZnJvbSBcIkBsaWJyYXJ5L2NvbXBvbmVudHMvYnV0dG9ucy9ncmFkaWVudFwiO1xuaW1wb3J0IGNoZWNrUmVmZXJlbmNlIGZyb20gXCIuLi8uLi9mbG93L3NjcmlwdHMvY2hlY2stcmVmLmNkY1wiO1xuaW1wb3J0IHVzZXJWYXVsdCBmcm9tIFwiLi4vLi4vZmxvdy90cmFuc2FjdGlvbnMvdXNlci12YXVsdC5jZGNcIjtcbmltcG9ydCBzdHlsZWQgZnJvbSBcIkBlbW90aW9uL3N0eWxlZFwiO1xuaW1wb3J0ICogYXMgZmNsIGZyb20gXCJAb25mbG93L2ZjbFwiO1xuaW1wb3J0IHsgV0hJVEUsIExJR0hUX0NPUkFMLCBNQUdJQ19NSU5UIH0gZnJvbSBcIkBzdHlsZS9jb2xvcnNcIjtcblxuY29uc3QgQ29udGFpbmVyID0gc3R5bGVkKFwiZGl2XCIpKHtcbiAgZGlzcGxheTogXCJmbGV4XCIsXG4gIGZsZXhEaXJlY3Rpb246IFwiY29sdW1uXCIsXG4gIGJvcmRlclJhZGl1czogMyxcbiAgYmFja2dyb3VuZENvbG9yOiBXSElURSxcbiAgYm94U2hhZG93OiBcIjAgMXB4IDJweCAwIHJnYmEoMCwwLDAsLjEpXCIsXG4gIHBhZGRpbmc6IFwiMXJlbVwiLFxufSk7XG5cbmNvbnN0IFdhbGxldFNldHRpbmdzID0gKCkgPT4ge1xuICBjb25zdCBbd2FsbGV0VXNlciwgc2V0V2FsbGV0VXNlcl0gPSB1c2VTdGF0ZShudWxsKTtcbiAgY29uc3QgW3dhbGxldElzU2V0dXAsIHNldFdhbGxldElzU2V0dXBdID0gdXNlU3RhdGUoZmFsc2UpO1xuXG4gIHVzZUVmZmVjdChcbiAgICAoKSA9PlxuICAgICAgZmNsLmN1cnJlbnRVc2VyKCkuc3Vic2NyaWJlKGFzeW5jICh1c2VyKSA9PiB7XG4gICAgICAgIGlmICh1c2VyLmxvZ2dlZEluKSB7XG4gICAgICAgICAgc2V0V2FsbGV0VXNlcih1c2VyKTtcbiAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgd2FsbGV0IGlzIHNldCB1cCB5ZXRcbiAgICAgICAgICBjb25zdCB3YWxsZXRTdGF0dXMgPSBhd2FpdCBjaGVja1VzZXJXYWxsZXRTdGF0dXMoKTtcbiAgICAgICAgICBzZXRXYWxsZXRJc1NldHVwKHdhbGxldFN0YXR1cyk7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJ3YWxsZXRTdGF0dXNcIiwgd2FsbGV0U3RhdHVzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcImlzIG5vdCBsb2dnZWQgaW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gY29uc29sZS5sb2coXCItLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXCIpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIi0tLS0tLS0tLS0gdXNlciEgLS0tLS0tLS0tLS0tLVwiLCB1c2VyKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCItLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXCIpO1xuICAgICAgfSksXG4gICAgW11cbiAgKTtcblxuICBjb25zdCB3YWxsZXRDb25uZWN0ZWQgPSB3YWxsZXRVc2VyICYmIHdhbGxldFVzZXIubG9nZ2VkSW47XG4gIGNvbnN0IHdhbGxldE5vdENvbm5lY3RlZCA9XG4gICAgd2FsbGV0VXNlciA9PT0gbnVsbCB8fCAod2FsbGV0VXNlciAmJiAhd2FsbGV0VXNlci5sb2dnZWRJbik7XG5cbiAgY29uc3QgZ2V0QWRkcmVzcyA9ICh1c2VyLCBudWxsUHJlZml4ID0gdHJ1ZSkgPT4ge1xuICAgIHJldHVybiBudWxsUHJlZml4ID8gYDB4JHt1c2VyLmFkZHJ9YCA6IHVzZXIuYWRkcjtcbiAgfTtcblxuICBjb25zdCBnZW5lcmF0ZUNvZGUgPSBhc3luYyAocmF3Q29kZSwgbWF0Y2gpID0+IHtcbiAgICBpZiAoIW1hdGNoKSB7XG4gICAgICByZXR1cm4gcmF3Q29kZTtcbiAgICB9XG4gICAgY29uc3QgeyBxdWVyeSB9ID0gbWF0Y2g7XG4gICAgcmV0dXJuIHJhd0NvZGUucmVwbGFjZShxdWVyeSwgKGl0ZW0pID0+IHtcbiAgICAgIHJldHVybiBtYXRjaFtpdGVtXTtcbiAgICB9KTtcbiAgfTtcblxuICBjb25zdCBzZXR1cFVzZXJXYWxsZXQgPSBhc3luYyAoKSA9PiB7XG4gICAgLy8gQ3JlYXRlIHRoZSB1c2VyIHZhdWx0XG4gICAgY29uc3QgdXNlciA9IGZjbC5jdXJyZW50VXNlcigpO1xuICAgIGNvbnN0IHsgYXV0aG9yaXphdGlvbiB9ID0gdXNlcjtcbiAgICBjb25zdCBzbmFwc2hvdCA9IGF3YWl0IHVzZXIuc25hcHNob3QoKTtcbiAgICBjb25zdCBhZGRyZXNzID0gZ2V0QWRkcmVzcyhzbmFwc2hvdCk7XG4gICAgY29uc3QgY29udHJhY3RBZGRyZXNzID0gXCIweDAxY2YwZTJmMmY3MTU0NTBcIjtcbiAgICBjb25zdCB0eENvZGUgPSBhd2FpdCBnZW5lcmF0ZUNvZGUodXNlclZhdWx0LCB7XG4gICAgICBxdWVyeTogLygweDAxfDB4MDIpL2csXG4gICAgICBcIjB4MDFcIjogY29udHJhY3RBZGRyZXNzLFxuICAgICAgXCIweDAyXCI6IGFkZHJlc3MsXG4gICAgfSk7XG4gICAgY29uc3QgaW5pdFJlc3BvbnNlID0gYXdhaXQgZmNsLnNlbmQoXG4gICAgICBbXG4gICAgICAgIHNkay50cmFuc2FjdGlvbmAke2luaXRDb2RlfWAsXG4gICAgICAgIGZjbC5wcm9wb3NlcihhdXRob3JpemF0aW9uKSxcbiAgICAgICAgZmNsLnBheWVyKGF1dGhvcml6YXRpb24pLFxuICAgICAgICBmY2wuYXV0aG9yaXphdGlvbnMoW2F1dGhvcml6YXRpb25dKSxcbiAgICAgICAgZmNsLmxpbWl0KDEwMCksXG4gICAgICBdLFxuICAgICAge1xuICAgICAgICBub2RlOiBcImh0dHA6Ly9sb2NhbGhvc3Q6ODA4MFwiLFxuICAgICAgfVxuICAgICk7XG4gICAgY29uc29sZS5sb2coXCJzZXR1cFVzZXJXYWxsZXQgc2NyaXB0Q29kZVwiLCBzY3JpcHRDb2RlKTtcbiAgfTtcblxuICBjb25zdCBjaGVja1VzZXJXYWxsZXRTdGF0dXMgPSBhc3luYyAoKSA9PiB7XG4gICAgY29uc29sZS5sb2coXCItLS0tLSBjaGVja1VzZXJXYWxsZXRTdGF0dXMgLS0tLS1cIik7XG4gICAgY29uc3QgdXNlciA9IGZjbC5jdXJyZW50VXNlcigpO1xuICAgIGNvbnN0IHNuYXBzaG90ID0gYXdhaXQgdXNlci5zbmFwc2hvdCgpO1xuICAgIGNvbnN0IGFkZHJlc3MgPSBnZXRBZGRyZXNzKHNuYXBzaG90KTtcbiAgICBjb25zdCBjb250cmFjdEFkZHJlc3MgPSBcIjB4MDFjZjBlMmYyZjcxNTQ1MFwiO1xuICAgIGNvbnN0IHNjcmlwdENvZGUgPSBhd2FpdCBnZW5lcmF0ZUNvZGUoY2hlY2tSZWZlcmVuY2UsIHtcbiAgICAgIHF1ZXJ5OiAvKDB4MDF8MHgwMikvZyxcbiAgICAgIFwiMHgwMVwiOiBjb250cmFjdEFkZHJlc3MsXG4gICAgICBcIjB4MDJcIjogYWRkcmVzcyxcbiAgICB9KTtcbiAgICBjb25zdCBzY3JpcHQgPSBzZGsuc2NyaXB0YCR7c2NyaXB0Q29kZX1gO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmNsLnNlbmQoW3NjcmlwdF0pO1xuICAgIGNvbnN0IGNoZWNrUmVzdWx0ID0gYXdhaXQgZmNsLmRlY29kZShyZXNwb25zZSk7XG4gICAgcmV0dXJuIGNoZWNrUmVzdWx0O1xuICB9O1xuXG4gIHJldHVybiAoXG4gICAgPENvbnRhaW5lcj5cbiAgICAgIDxkaXY+XG4gICAgICAgIHt3YWxsZXROb3RDb25uZWN0ZWQgJiYgKFxuICAgICAgICAgIDxDb3JhbEJ1dHRvbiBvbkNsaWNrPXtmY2wuYXV0aGVudGljYXRlfT5Db25uZWN0IFdhbGxldDwvQ29yYWxCdXR0b24+XG4gICAgICAgICl9XG4gICAgICAgIDxiciAvPlxuICAgICAgICA8YnIgLz5cbiAgICAgICAgPGJyIC8+XG4gICAgICAgIHt3YWxsZXRDb25uZWN0ZWQgJiYgIXdhbGxldElzU2V0dXAgJiYgKFxuICAgICAgICAgIDxDb3JhbEJ1dHRvbiBvbkNsaWNrPXtzZXR1cFVzZXJXYWxsZXR9PlNldHVwIFdhbGxldDwvQ29yYWxCdXR0b24+XG4gICAgICAgICl9XG5cbiAgICAgICAge3dhbGxldENvbm5lY3RlZCAmJiAoXG4gICAgICAgICAgPGRpdiBzdHlsZT17eyBmb250U2l6ZTogMTQgfX0+XG4gICAgICAgICAgICA8SlNPTlByZXR0eSBpZD1cImpzb24tcHJldHR5XCIgZGF0YT17d2FsbGV0VXNlcn0+PC9KU09OUHJldHR5PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICApfVxuICAgICAgPC9kaXY+XG4gICAgPC9Db250YWluZXI+XG4gICk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBXYWxsZXRTZXR0aW5ncztcbiJdfQ== */\");\n\nconst WalletSettings = () => {\n  const {\n    0: walletUser,\n    1: setWalletUser\n  } = useState(null);\n  const {\n    0: walletIsSetup,\n    1: setWalletIsSetup\n  } = useState(false);\n  useEffect(() => fcl.currentUser().subscribe(async user => {\n    if (user.loggedIn) {\n      setWalletUser(user); // Check if the wallet is set up yet\n\n      const walletStatus = await checkUserWalletStatus();\n      setWalletIsSetup(walletStatus);\n      console.log(\"walletStatus\", walletStatus);\n    } else {\n      console.log(\"is not logged in\");\n    } // console.log(\"-------------------------\");\n    // console.log(\"---------- user! -------------\", user);\n    // console.log(\"-------------------------\");\n\n  }), []);\n  const walletConnected = walletUser && walletUser.loggedIn;\n  const walletNotConnected = walletUser === null || walletUser && !walletUser.loggedIn;\n\n  const getAddress = (user, nullPrefix = true) => {\n    return nullPrefix ? `0x${user.addr}` : user.addr;\n  };\n\n  const generateCode = async (rawCode, match) => {\n    if (!match) {\n      return rawCode;\n    }\n\n    const {\n      query\n    } = match;\n    return rawCode.replace(query, item => {\n      return match[item];\n    });\n  };\n\n  const setupUserWallet = async () => {\n    // Create the user vault\n    const user = fcl.currentUser();\n    const {\n      authorization\n    } = user;\n    const snapshot = await user.snapshot();\n    const address = getAddress(snapshot);\n    const contractAddress = \"0x01cf0e2f2f715450\";\n    const txCode = await generateCode(userVault, {\n      query: /(0x01|0x02)/g,\n      \"0x01\": contractAddress,\n      \"0x02\": address\n    });\n    const initResponse = await fcl.send([sdk.transaction`${initCode}`, fcl.proposer(authorization), fcl.payer(authorization), fcl.authorizations([authorization]), fcl.limit(100)], {\n      node: \"http://localhost:8080\"\n    });\n    console.log(\"setupUserWallet scriptCode\", scriptCode);\n  };\n\n  const checkUserWalletStatus = async () => {\n    console.log(\"----- checkUserWalletStatus -----\");\n    const user = fcl.currentUser();\n    const snapshot = await user.snapshot();\n    const address = getAddress(snapshot);\n    const contractAddress = \"0x01cf0e2f2f715450\";\n    const scriptCode = await generateCode(checkReference, {\n      query: /(0x01|0x02)/g,\n      \"0x01\": contractAddress,\n      \"0x02\": address\n    });\n    const script = sdk.script`${scriptCode}`;\n    const response = await fcl.send([script]);\n    const checkResult = await fcl.decode(response);\n    return checkResult;\n  };\n\n  return __jsx(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 7\n    }\n  }, walletNotConnected && __jsx(CoralButton, {\n    onClick: fcl.authenticate,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 11\n    }\n  }, \"Connect Wallet\"), __jsx(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 9\n    }\n  }), __jsx(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 9\n    }\n  }), __jsx(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 9\n    }\n  }), walletConnected && !walletIsSetup && __jsx(CoralButton, {\n    onClick: setupUserWallet,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 11\n    }\n  }, \"Setup Wallet\"), walletConnected && __jsx(\"div\", {\n    style: {\n      fontSize: 14\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 11\n    }\n  }, __jsx(JSONPretty, {\n    id: \"json-pretty\",\n    data: walletUser,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 13\n    }\n  }))));\n};\n\nexport default WalletSettings;","map":{"version":3,"sources":["/Users/lukehamilton/development/lyra-labs-dev/lyra-labs/frontend/components/wallet-settings/index.js"],"names":["React","useState","useEffect","sdk","JSONPretty","CoralButton","MintButton","GradientButton","checkReference","userVault","fcl","WHITE","LIGHT_CORAL","MAGIC_MINT","Container","display","flexDirection","borderRadius","backgroundColor","boxShadow","padding","WalletSettings","walletUser","setWalletUser","walletIsSetup","setWalletIsSetup","currentUser","subscribe","user","loggedIn","walletStatus","checkUserWalletStatus","console","log","walletConnected","walletNotConnected","getAddress","nullPrefix","addr","generateCode","rawCode","match","query","replace","item","setupUserWallet","authorization","snapshot","address","contractAddress","txCode","initResponse","send","transaction","initCode","proposer","payer","authorizations","limit","node","scriptCode","script","response","checkResult","decode","authenticate","fontSize"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,QAA2C,OAA3C;AACA,OAAO,KAAKC,GAAZ,MAAqB,aAArB;AACA,OAAOC,UAAP,MAAuB,mBAAvB;AACA,OAAOC,WAAP,MAAwB,mCAAxB;AACA,OAAOC,UAAP,MAAuB,kCAAvB;AACA,OAAOC,cAAP,MAA2B,sCAA3B;AACA,OAAOC,cAAP,MAA2B,kCAA3B;AACA,OAAOC,SAAP,MAAsB,wCAAtB;AAEA,OAAO,KAAKC,GAAZ,MAAqB,aAArB;AACA,SAASC,KAAT,EAAgBC,WAAhB,EAA6BC,UAA7B,QAA+C,eAA/C;;AAEA,MAAMC,SAAS,GAAG,qBAAO,KAAP;AAAA;AAAA;AAAA,GAAc;AAC9BC,EAAAA,OAAO,EAAE,MADqB;AAE9BC,EAAAA,aAAa,EAAE,QAFe;AAG9BC,EAAAA,YAAY,EAAE,CAHgB;AAI9BC,EAAAA,eAAe,EAAEP,KAJa;AAK9BQ,EAAAA,SAAS,EAAE,4BALmB;AAM9BC,EAAAA,OAAO,EAAE;AANqB,CAAd,y4LAAlB;;AASA,MAAMC,cAAc,GAAG,MAAM;AAC3B,QAAM;AAAA,OAACC,UAAD;AAAA,OAAaC;AAAb,MAA8BtB,QAAQ,CAAC,IAAD,CAA5C;AACA,QAAM;AAAA,OAACuB,aAAD;AAAA,OAAgBC;AAAhB,MAAoCxB,QAAQ,CAAC,KAAD,CAAlD;AAEAC,EAAAA,SAAS,CACP,MACEQ,GAAG,CAACgB,WAAJ,GAAkBC,SAAlB,CAA4B,MAAOC,IAAP,IAAgB;AAC1C,QAAIA,IAAI,CAACC,QAAT,EAAmB;AACjBN,MAAAA,aAAa,CAACK,IAAD,CAAb,CADiB,CAEjB;;AACA,YAAME,YAAY,GAAG,MAAMC,qBAAqB,EAAhD;AACAN,MAAAA,gBAAgB,CAACK,YAAD,CAAhB;AACAE,MAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ,EAA4BH,YAA5B;AACD,KAND,MAMO;AACLE,MAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ;AACD,KATyC,CAU1C;AACA;AACA;;AACD,GAbD,CAFK,EAgBP,EAhBO,CAAT;AAmBA,QAAMC,eAAe,GAAGZ,UAAU,IAAIA,UAAU,CAACO,QAAjD;AACA,QAAMM,kBAAkB,GACtBb,UAAU,KAAK,IAAf,IAAwBA,UAAU,IAAI,CAACA,UAAU,CAACO,QADpD;;AAGA,QAAMO,UAAU,GAAG,CAACR,IAAD,EAAOS,UAAU,GAAG,IAApB,KAA6B;AAC9C,WAAOA,UAAU,GAAI,KAAIT,IAAI,CAACU,IAAK,EAAlB,GAAsBV,IAAI,CAACU,IAA5C;AACD,GAFD;;AAIA,QAAMC,YAAY,GAAG,OAAOC,OAAP,EAAgBC,KAAhB,KAA0B;AAC7C,QAAI,CAACA,KAAL,EAAY;AACV,aAAOD,OAAP;AACD;;AACD,UAAM;AAAEE,MAAAA;AAAF,QAAYD,KAAlB;AACA,WAAOD,OAAO,CAACG,OAAR,CAAgBD,KAAhB,EAAwBE,IAAD,IAAU;AACtC,aAAOH,KAAK,CAACG,IAAD,CAAZ;AACD,KAFM,CAAP;AAGD,GARD;;AAUA,QAAMC,eAAe,GAAG,YAAY;AAClC;AACA,UAAMjB,IAAI,GAAGlB,GAAG,CAACgB,WAAJ,EAAb;AACA,UAAM;AAAEoB,MAAAA;AAAF,QAAoBlB,IAA1B;AACA,UAAMmB,QAAQ,GAAG,MAAMnB,IAAI,CAACmB,QAAL,EAAvB;AACA,UAAMC,OAAO,GAAGZ,UAAU,CAACW,QAAD,CAA1B;AACA,UAAME,eAAe,GAAG,oBAAxB;AACA,UAAMC,MAAM,GAAG,MAAMX,YAAY,CAAC9B,SAAD,EAAY;AAC3CiC,MAAAA,KAAK,EAAE,cADoC;AAE3C,cAAQO,eAFmC;AAG3C,cAAQD;AAHmC,KAAZ,CAAjC;AAKA,UAAMG,YAAY,GAAG,MAAMzC,GAAG,CAAC0C,IAAJ,CACzB,CACEjD,GAAG,CAACkD,WAAY,GAAEC,QAAS,EAD7B,EAEE5C,GAAG,CAAC6C,QAAJ,CAAaT,aAAb,CAFF,EAGEpC,GAAG,CAAC8C,KAAJ,CAAUV,aAAV,CAHF,EAIEpC,GAAG,CAAC+C,cAAJ,CAAmB,CAACX,aAAD,CAAnB,CAJF,EAKEpC,GAAG,CAACgD,KAAJ,CAAU,GAAV,CALF,CADyB,EAQzB;AACEC,MAAAA,IAAI,EAAE;AADR,KARyB,CAA3B;AAYA3B,IAAAA,OAAO,CAACC,GAAR,CAAY,4BAAZ,EAA0C2B,UAA1C;AACD,GAzBD;;AA2BA,QAAM7B,qBAAqB,GAAG,YAAY;AACxCC,IAAAA,OAAO,CAACC,GAAR,CAAY,mCAAZ;AACA,UAAML,IAAI,GAAGlB,GAAG,CAACgB,WAAJ,EAAb;AACA,UAAMqB,QAAQ,GAAG,MAAMnB,IAAI,CAACmB,QAAL,EAAvB;AACA,UAAMC,OAAO,GAAGZ,UAAU,CAACW,QAAD,CAA1B;AACA,UAAME,eAAe,GAAG,oBAAxB;AACA,UAAMW,UAAU,GAAG,MAAMrB,YAAY,CAAC/B,cAAD,EAAiB;AACpDkC,MAAAA,KAAK,EAAE,cAD6C;AAEpD,cAAQO,eAF4C;AAGpD,cAAQD;AAH4C,KAAjB,CAArC;AAKA,UAAMa,MAAM,GAAG1D,GAAG,CAAC0D,MAAO,GAAED,UAAW,EAAvC;AACA,UAAME,QAAQ,GAAG,MAAMpD,GAAG,CAAC0C,IAAJ,CAAS,CAACS,MAAD,CAAT,CAAvB;AACA,UAAME,WAAW,GAAG,MAAMrD,GAAG,CAACsD,MAAJ,CAAWF,QAAX,CAA1B;AACA,WAAOC,WAAP;AACD,GAfD;;AAiBA,SACE,MAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACG5B,kBAAkB,IACjB,MAAC,WAAD;AAAa,IAAA,OAAO,EAAEzB,GAAG,CAACuD,YAA1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAFJ,EAIE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAJF,EAKE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IALF,EAME;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IANF,EAOG/B,eAAe,IAAI,CAACV,aAApB,IACC,MAAC,WAAD;AAAa,IAAA,OAAO,EAAEqB,eAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBARJ,EAWGX,eAAe,IACd;AAAK,IAAA,KAAK,EAAE;AAAEgC,MAAAA,QAAQ,EAAE;AAAZ,KAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,UAAD;AAAY,IAAA,EAAE,EAAC,aAAf;AAA6B,IAAA,IAAI,EAAE5C,UAAnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,CAZJ,CADF,CADF;AAqBD,CA1GD;;AA4GA,eAAeD,cAAf","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport * as sdk from \"@onflow/sdk\";\nimport JSONPretty from \"react-json-pretty\";\nimport CoralButton from \"@library/components/buttons/coral\";\nimport MintButton from \"@library/components/buttons/mint\";\nimport GradientButton from \"@library/components/buttons/gradient\";\nimport checkReference from \"../../flow/scripts/check-ref.cdc\";\nimport userVault from \"../../flow/transactions/user-vault.cdc\";\nimport styled from \"@emotion/styled\";\nimport * as fcl from \"@onflow/fcl\";\nimport { WHITE, LIGHT_CORAL, MAGIC_MINT } from \"@style/colors\";\n\nconst Container = styled(\"div\")({\n  display: \"flex\",\n  flexDirection: \"column\",\n  borderRadius: 3,\n  backgroundColor: WHITE,\n  boxShadow: \"0 1px 2px 0 rgba(0,0,0,.1)\",\n  padding: \"1rem\",\n});\n\nconst WalletSettings = () => {\n  const [walletUser, setWalletUser] = useState(null);\n  const [walletIsSetup, setWalletIsSetup] = useState(false);\n\n  useEffect(\n    () =>\n      fcl.currentUser().subscribe(async (user) => {\n        if (user.loggedIn) {\n          setWalletUser(user);\n          // Check if the wallet is set up yet\n          const walletStatus = await checkUserWalletStatus();\n          setWalletIsSetup(walletStatus);\n          console.log(\"walletStatus\", walletStatus);\n        } else {\n          console.log(\"is not logged in\");\n        }\n        // console.log(\"-------------------------\");\n        // console.log(\"---------- user! -------------\", user);\n        // console.log(\"-------------------------\");\n      }),\n    []\n  );\n\n  const walletConnected = walletUser && walletUser.loggedIn;\n  const walletNotConnected =\n    walletUser === null || (walletUser && !walletUser.loggedIn);\n\n  const getAddress = (user, nullPrefix = true) => {\n    return nullPrefix ? `0x${user.addr}` : user.addr;\n  };\n\n  const generateCode = async (rawCode, match) => {\n    if (!match) {\n      return rawCode;\n    }\n    const { query } = match;\n    return rawCode.replace(query, (item) => {\n      return match[item];\n    });\n  };\n\n  const setupUserWallet = async () => {\n    // Create the user vault\n    const user = fcl.currentUser();\n    const { authorization } = user;\n    const snapshot = await user.snapshot();\n    const address = getAddress(snapshot);\n    const contractAddress = \"0x01cf0e2f2f715450\";\n    const txCode = await generateCode(userVault, {\n      query: /(0x01|0x02)/g,\n      \"0x01\": contractAddress,\n      \"0x02\": address,\n    });\n    const initResponse = await fcl.send(\n      [\n        sdk.transaction`${initCode}`,\n        fcl.proposer(authorization),\n        fcl.payer(authorization),\n        fcl.authorizations([authorization]),\n        fcl.limit(100),\n      ],\n      {\n        node: \"http://localhost:8080\",\n      }\n    );\n    console.log(\"setupUserWallet scriptCode\", scriptCode);\n  };\n\n  const checkUserWalletStatus = async () => {\n    console.log(\"----- checkUserWalletStatus -----\");\n    const user = fcl.currentUser();\n    const snapshot = await user.snapshot();\n    const address = getAddress(snapshot);\n    const contractAddress = \"0x01cf0e2f2f715450\";\n    const scriptCode = await generateCode(checkReference, {\n      query: /(0x01|0x02)/g,\n      \"0x01\": contractAddress,\n      \"0x02\": address,\n    });\n    const script = sdk.script`${scriptCode}`;\n    const response = await fcl.send([script]);\n    const checkResult = await fcl.decode(response);\n    return checkResult;\n  };\n\n  return (\n    <Container>\n      <div>\n        {walletNotConnected && (\n          <CoralButton onClick={fcl.authenticate}>Connect Wallet</CoralButton>\n        )}\n        <br />\n        <br />\n        <br />\n        {walletConnected && !walletIsSetup && (\n          <CoralButton onClick={setupUserWallet}>Setup Wallet</CoralButton>\n        )}\n\n        {walletConnected && (\n          <div style={{ fontSize: 14 }}>\n            <JSONPretty id=\"json-pretty\" data={walletUser}></JSONPretty>\n          </div>\n        )}\n      </div>\n    </Container>\n  );\n};\n\nexport default WalletSettings;\n"]},"metadata":{},"sourceType":"module"}