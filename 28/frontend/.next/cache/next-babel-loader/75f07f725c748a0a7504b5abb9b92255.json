{"ast":null,"code":"var _jsxFileName = \"/Users/lukehamilton/development/lyra-labs-dev/lyra-labs/frontend/shared/enhancers/auth-provider.js\";\nvar __jsx = React.createElement;\nimport React, { createContext, useContext, useState, useEffect } from \"react\";\nimport { useRouter } from \"next/router\";\nconst AuthContext = createContext();\n\nfunction AuthProvider({\n  children\n}) {\n  const {\n    pathname,\n    events\n  } = useRouter();\n  const {\n    0: user,\n    1: setUser\n  } = useState();\n\n  async function getUser() {\n    try {\n      const response = await fetch(\"/api/me\");\n      const profile = await response.json();\n\n      if (profile.error) {\n        setUser(null);\n      } else {\n        setUser(profile);\n      }\n    } catch (err) {\n      console.error(err);\n    }\n  }\n\n  useEffect(() => {\n    getUser();\n  }, [pathname]);\n  useEffect(() => {\n    // Check that a new route is OK\n    const handleRouteChange = url => {\n      console.log(\"handlingRouteChange\", user);\n\n      if (url !== \"/\" && !user) {\n        window.location.href = \"/\";\n      }\n    }; // Check that initial route is OK\n\n\n    if (pathname !== \"/\" && user === null) {\n      window.location.href = \"/\";\n    } // Monitor routes\n\n\n    events.on(\"routeChangeStart\", handleRouteChange);\n    return () => {\n      events.off(\"routeChangeStart\", handleRouteChange);\n    };\n  }, [user]);\n  return __jsx(AuthContext.Provider, {\n    value: {\n      user\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 49\n    },\n    __self: this\n  }, children);\n}\n\nconst useAuth = () => useContext(AuthContext);\n\nexport { AuthProvider, useAuth };","map":{"version":3,"sources":["/Users/lukehamilton/development/lyra-labs-dev/lyra-labs/frontend/shared/enhancers/auth-provider.js"],"names":["React","createContext","useContext","useState","useEffect","useRouter","AuthContext","AuthProvider","children","pathname","events","user","setUser","getUser","response","fetch","profile","json","error","err","console","handleRouteChange","url","log","window","location","href","on","off","useAuth"],"mappings":";;AAAA,OAAOA,KAAP,IAAgBC,aAAhB,EAA+BC,UAA/B,EAA2CC,QAA3C,EAAqDC,SAArD,QAAsE,OAAtE;AACA,SAASC,SAAT,QAA0B,aAA1B;AACA,MAAMC,WAAW,GAAGL,aAAa,EAAjC;;AAEA,SAASM,YAAT,CAAsB;AAAEC,EAAAA;AAAF,CAAtB,EAAoC;AAClC,QAAM;AAAEC,IAAAA,QAAF;AAAYC,IAAAA;AAAZ,MAAuBL,SAAS,EAAtC;AACA,QAAM;AAAA,OAACM,IAAD;AAAA,OAAOC;AAAP,MAAkBT,QAAQ,EAAhC;;AAEA,iBAAeU,OAAf,GAAyB;AACvB,QAAI;AACF,YAAMC,QAAQ,GAAG,MAAMC,KAAK,CAAC,SAAD,CAA5B;AACA,YAAMC,OAAO,GAAG,MAAMF,QAAQ,CAACG,IAAT,EAAtB;;AACA,UAAID,OAAO,CAACE,KAAZ,EAAmB;AACjBN,QAAAA,OAAO,CAAC,IAAD,CAAP;AACD,OAFD,MAEO;AACLA,QAAAA,OAAO,CAACI,OAAD,CAAP;AACD;AACF,KARD,CAQE,OAAOG,GAAP,EAAY;AACZC,MAAAA,OAAO,CAACF,KAAR,CAAcC,GAAd;AACD;AACF;;AAEDf,EAAAA,SAAS,CAAC,MAAM;AACdS,IAAAA,OAAO;AACR,GAFQ,EAEN,CAACJ,QAAD,CAFM,CAAT;AAIAL,EAAAA,SAAS,CAAC,MAAM;AACd;AACA,UAAMiB,iBAAiB,GAAIC,GAAD,IAAS;AACjCF,MAAAA,OAAO,CAACG,GAAR,CAAY,qBAAZ,EAAmCZ,IAAnC;;AACA,UAAIW,GAAG,KAAK,GAAR,IAAe,CAACX,IAApB,EAA0B;AACxBa,QAAAA,MAAM,CAACC,QAAP,CAAgBC,IAAhB,GAAuB,GAAvB;AACD;AACF,KALD,CAFc,CASd;;;AACA,QAAIjB,QAAQ,KAAK,GAAb,IAAoBE,IAAI,KAAK,IAAjC,EAAuC;AACrCa,MAAAA,MAAM,CAACC,QAAP,CAAgBC,IAAhB,GAAuB,GAAvB;AACD,KAZa,CAcd;;;AACAhB,IAAAA,MAAM,CAACiB,EAAP,CAAU,kBAAV,EAA8BN,iBAA9B;AACA,WAAO,MAAM;AACXX,MAAAA,MAAM,CAACkB,GAAP,CAAW,kBAAX,EAA+BP,iBAA/B;AACD,KAFD;AAGD,GAnBQ,EAmBN,CAACV,IAAD,CAnBM,CAAT;AAqBA,SACE,MAAC,WAAD,CAAa,QAAb;AAAsB,IAAA,KAAK,EAAE;AAAEA,MAAAA;AAAF,KAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAwCH,QAAxC,CADF;AAGD;;AAED,MAAMqB,OAAO,GAAG,MAAM3B,UAAU,CAACI,WAAD,CAAhC;;AAEA,SAASC,YAAT,EAAuBsB,OAAvB","sourcesContent":["import React, { createContext, useContext, useState, useEffect } from \"react\";\nimport { useRouter } from \"next/router\";\nconst AuthContext = createContext();\n\nfunction AuthProvider({ children }) {\n  const { pathname, events } = useRouter();\n  const [user, setUser] = useState();\n\n  async function getUser() {\n    try {\n      const response = await fetch(\"/api/me\");\n      const profile = await response.json();\n      if (profile.error) {\n        setUser(null);\n      } else {\n        setUser(profile);\n      }\n    } catch (err) {\n      console.error(err);\n    }\n  }\n\n  useEffect(() => {\n    getUser();\n  }, [pathname]);\n\n  useEffect(() => {\n    // Check that a new route is OK\n    const handleRouteChange = (url) => {\n      console.log(\"handlingRouteChange\", user);\n      if (url !== \"/\" && !user) {\n        window.location.href = \"/\";\n      }\n    };\n\n    // Check that initial route is OK\n    if (pathname !== \"/\" && user === null) {\n      window.location.href = \"/\";\n    }\n\n    // Monitor routes\n    events.on(\"routeChangeStart\", handleRouteChange);\n    return () => {\n      events.off(\"routeChangeStart\", handleRouteChange);\n    };\n  }, [user]);\n\n  return (\n    <AuthContext.Provider value={{ user }}>{children}</AuthContext.Provider>\n  );\n}\n\nconst useAuth = () => useContext(AuthContext);\n\nexport { AuthProvider, useAuth };\n"]},"metadata":{},"sourceType":"module"}